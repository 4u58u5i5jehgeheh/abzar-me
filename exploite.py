import logging
from telegram import Update
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackContext
import requests

# تنظیمات لاگینگ
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# توکن ربات تلگرام خود را در اینجا قرار دهید
TOKEN = '7686347838:AAHok7BBglSFxXzXyZdoaV2rQ_99kTdTdww'

# تابع برای جستجوی کلمه در کل تلگرام
def search_word_in_telegram(word):
    # اینجا می‌توانید از API های جستجوی تلگرام استفاده کنید
    # به عنوان مثال، می‌توانید از API های جستجوی سوپرگروپ‌ها یا کانال‌ها استفاده کنید
    # اما توجه داشته باشید که API های جستجوی تلگرام به طور عمومی در دسترس نیستند
    # بنابراین باید از روش‌های دیگری مانند استفاده از سرویس‌های جستجوی خارجی استفاده کنید
    # در اینجا یک نمونه ساده برای نشان دادن ایده ارائه می‌شود
    search_url = f"https://api.telegram.org/bot{TOKEN}/search?q={word}"
    response = requests.get(search_url)
    if response.status_code == 200:
        return response.json()
    else:
        return None

# تابع برای پردازش دستور /start
def start(update: Update, context: CallbackContext) -> None:
    update.message.reply_text('سلام! برای جستجوی یک کلمه یا متن کوتاه، متن مورد نظر را به من بدهید.')

# تابع برای پردازش پیام‌های متنی
def search(update: Update, context: CallbackContext) -> None:
    word = update.message.text
    update.message.reply_text(f'در حال جستجو برای کلمه "{word}"...')
    
    # جستجوی کلمه در کل تلگرام
    results = search_word_in_telegram(word)
    
    if results:
        for result in results:
            update.message.reply_text(f"لینک پیام: {result['link']}")
    else:
        update.message.reply_text('متاسفانه نتیجه‌ای پیدا نشد.')

def main() -> None:
    # ایجاد یک شی Updater با استفاده از توکن ربات
    updater = Updater(TOKEN)

    # دریافت دیسپاچر برای ثبت کنترل‌ها
    dispatcher = updater.dispatcher

    # ثبت کنترل‌ها برای دستور /start و پیام‌های متنی
    dispatcher.add_handler(CommandHandler("start", start))
    dispatcher.add_handler(MessageHandler(Filters.text & ~Filters.command, search))

    # شروع ربات
    updater.start_polling()

    # اجازه دادن به ربات برای اجرا تا زمانی که Ctrl-C را فشار دهید
    updater.idle()

if __name__ == '__main__':
    main()
